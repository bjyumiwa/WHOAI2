<!-- FILE: /WHOAI2/whoai_talk_tane.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WhoAI | ä¼šè©±ï¼ˆã‚¿ãƒï¼‰ï¼‹éŸ³ç¬¦åé›†ï¼šãƒãƒƒãƒ”ãƒ¼ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼</title>
<meta name="color-scheme" content="dark light" />
<style>
  /* ====== Base ====== */
  html,body{height:100%;margin:0}
  body{
    font-family:"Noto Sans JP",system-ui,sans-serif;color:#fff;background:#000;
    background-image:url("space_background.png"); /* ä»•æ§˜ï¼šãƒ«ãƒ¼ãƒˆç›´ä¸‹å‚ç…§ */
    background-size:cover;background-position:center;background-attachment:fixed;
  }
  .wrap{
    min-height:100%;display:flex;flex-direction:column;
    backdrop-filter:saturate(110%) blur(0px);
  }
  header{
    display:flex;align-items:center;gap:10px;
    padding:10px 14px;background:rgba(0,0,0,.32);border-bottom:1px solid rgba(255,255,255,.15)
  }
  .badge{
    background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.25);
    padding:.25rem .6rem;border-radius:999px;font-size:12px
  }
  main{flex:1;display:grid;grid-template-rows:1fr auto;row-gap:10px}
  /* ====== Chat tiny UI ====== */
  .chat{
    width:min(1000px,92vw);margin:16px auto 0;display:grid;grid-template-columns:1fr;gap:10px
  }
  .stage{
    position:relative;min-height:46vh;border-radius:20px;
    border:1px solid rgba(255,255,255,.18);
    background:linear-gradient(180deg,rgba(0,0,0,.22),rgba(0,0,0,.35));
    overflow:hidden
  }
  .bubble{
    max-width:min(70ch,86%);padding:.7rem .9rem;border-radius:14px;margin:10px;
    background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.22)
  }
  .me{justify-self:end;background:rgba(255,255,255,.18)}
  .inputRow{
    width:min(1000px,92vw);margin:0 auto 16px;display:grid;grid-template-columns:1fr auto;gap:8px
  }
  input[type="text"]{
    border-radius:12px;border:1px solid rgba(255,255,255,.22);background:rgba(0,0,0,.35);
    padding:.8rem .9rem;color:#fff
  }
  button{
    padding:.8rem 1.1rem;border-radius:12px;border:0;cursor:pointer;font-weight:800
  }
  .primary{background:#f7b0bf;color:#222}
  .ghost{background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.22)}

  /* ====== poo / note ====== */
  .poo {
    position:absolute;z-index:40;cursor:pointer;user-select:none;
    font-size:clamp(28px,4vw,42px);
    filter:drop-shadow(0 4px 10px rgba(0,0,0,.35));
  }
  .note-float{
    position:fixed;z-index:60;pointer-events:none;
    font-size:clamp(20px,3vw,30px);
    animation:noteFloat 1.2s ease-out forwards;
  }
  @keyframes noteFloat{
    0%{transform:translateY(0) scale(1);opacity:0}
    10%{opacity:1}
    100%{transform:translateY(-120px) scale(1.2);opacity:0}
  }

  /* ====== collection modal ====== */
  #openCollectBtn{
    position:fixed;right:16px;bottom:16px;z-index:70;
    width:56px;height:56px;border-radius:50%;
    background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.25);
    color:#fff;font-weight:900;font-size:22px;cursor:pointer;backdrop-filter:blur(6px)
  }
  #songModal{position:fixed;inset:0;z-index:80;display:none;background:rgba(0,0,0,.45)}
  #songSheet{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    width:min(92vw,720px);max-height:82vh;overflow:auto;
    background:rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.25);
    border-radius:16px;padding:16px 16px 20px;backdrop-filter:blur(8px)
  }
  #songSheet h3{margin:0 0 6px}
  .score-row{display:flex;flex-wrap:wrap;gap:6px;align-items:center;margin:8px 0 12px}
  .note-cell{
    min-width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;
    font-weight:800;letter-spacing:.02em;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.2)
  }
  .note-cell.filled{background:rgba(255,255,255,.18);border-color:rgba(255,255,255,.35)}
  .legend{font-size:13px;opacity:.95;margin:6px 0}
  .modal-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
  .modal-actions .ghost{background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.22)}
  .modal-actions .primary{background:#f7b0bf;color:#222}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="badge">ã‚¿ãƒä¼šè©±</div>
    <div class="badge">ğŸ‚ ãƒãƒƒãƒ”ãƒ¼ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚’å®Œæˆã•ã›ã‚ˆã†</div>
    <div class="badge">ğŸ’©10å›ï¼ã€Œãƒ‰ã€1ã¤</div>
  </header>

  <main>
    <!-- è¦³å¯Ÿï¼‹ãŠä¸–è©±ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆğŸ’©ãŒæ¹§ãï¼‰ -->
    <section class="chat">
      <div class="stage" id="stage">
        <div class="bubble">ã‚„ãï¼è©±ã—ã‹ã‘ãŸã‚Šã€ãŠä¸–è©±ã‚’ã—ã¦ãã‚Œã‚‹ã¨ã€éŸ³ç¬¦ãŒé›†ã¾ã‚‹ã‚ˆâ™ª</div>
      </div>

      <!-- å…¥åŠ›åˆ—ï¼ˆEnterã§é€ä¿¡â†’éŸ³ç¬¦ãŒ1ã¤é€²ã‚€ï¼‰ -->
      <div class="inputRow">
        <input id="msg" type="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ï¼ˆEnterã§é€ä¿¡ï¼‰" />
        <button id="sendBtn" class="primary">é€ä¿¡</button>
      </div>
    </section>
  </main>
</div>

<!-- â™ª ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå³ä¸‹ãƒœã‚¿ãƒ³ï¼‰ -->
<button id="openCollectBtn" title="éŸ³ç¬¦ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³">â™ª</button>

<!-- â™ª ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="songModal" aria-hidden="true">
  <div id="songSheet" role="dialog" aria-label="éŸ³ç¬¦ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³">
    <h3>ğŸ‚ ãƒãƒƒãƒ”ãƒ¼ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ï¼ˆãƒ•ãƒ«ï¼š4ãƒ•ãƒ¬ãƒ¼ã‚ºï¼‰</h3>
    <div id="scoreRow" class="score-row"></div>
    <div id="noteSummary" class="legend"></div>
    <div class="modal-actions">
      <button class="ghost" id="resetSongBtn">ã‚„ã‚Šç›´ã™</button>
      <button class="primary" id="closeCollectBtn">ã¨ã˜ã‚‹</button>
    </div>
  </div>
</div>

<script>
/* ===============================
   ğŸµ Happy Birthday (Full) Setup
   ===============================

   èª¿ï¼šCï¼ˆãƒé•·èª¿ï¼‰
   ã‚½ ã‚½ ãƒ© ã‚½ ãƒ‰ ã‚· |
   ã‚½ ã‚½ ãƒ© ã‚½ ãƒ¬ ãƒ‰ |
   ã‚½ ã‚½ ã‚½ ãƒŸ ãƒ‰ ã‚· ãƒ© |
   ãƒ•ã‚¡ ãƒ•ã‚¡ ãƒŸ ãƒ‰ ãƒ¬ ãƒ‰
*/
const SONGS = {
  birthday_full: [
    "ã‚½","ã‚½","ãƒ©","ã‚½","ãƒ‰","ã‚·",
    "ã‚½","ã‚½","ãƒ©","ã‚½","ãƒ¬","ãƒ‰",
    "ã‚½","ã‚½","ã‚½","ãƒŸ","ãƒ‰","ã‚·","ãƒ©",
    "ãƒ•ã‚¡","ãƒ•ã‚¡","ãƒŸ","ãƒ‰","ãƒ¬","ãƒ‰"
  ]
};
let currentSong = 'birthday_full';

/* ===== æ°¸ç¶šåŒ–ã‚­ãƒ¼ ===== */
const LS = {
  collected: 'whoai_notes_collected_full',
  poo:       'whoai_poo_count',
  ready:     'whoai_song_complete_full'
};

/* ===== å¾©å…ƒ ===== */
let collectedNotes = JSON.parse(localStorage.getItem(LS.collected) || '[]');
let pooCount = Number(localStorage.getItem(LS.poo) || 0);

/* ===== å‚ç…§ ===== */
const stage = document.getElementById('stage');
const msg   = document.getElementById('msg');
const sendBtn = document.getElementById('sendBtn');

const openCollectBtn  = document.getElementById('openCollect
