<!-- FILE: /WHOAI2/whoai_talk_tane.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>WhoAI | タネ観察（進化前）</title>
<meta name="color-scheme" content="dark light" />
<link rel="icon"
  href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.85em' font-size='80'%3E🌱%3C/text%3E%3C/svg%3E" />
<style>
  :root{
    --glass: rgba(0,0,0,.35);
    --brd: rgba(255,255,255,.18);
    --ok:#86efac; --warn:#fde047; --bad:#fda4af;
    --ink:#fff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;overflow:hidden}
  body{
    font-family:"Noto Sans JP",system-ui,sans-serif;color:var(--ink);
    background:#000 url("space_background.png") center/cover fixed no-repeat;
  }

  /* HUD */
  .chips{position:fixed;left:50%;top:8px;transform:translateX(-50%);
    display:flex;gap:8px;flex-wrap:wrap;justify-content:center;z-index:5}
  .chip{background:var(--glass);backdrop-filter:blur(5px);
    border:1px solid var(--brd);padding:6px 10px;border-radius:999px;font-size:12px}

  .title{position:fixed;left:50%;top:44px;transform:translateX(-50%);
    font-weight:800;text-align:center;z-index:4}
  .subtitle{position:fixed;left:50%;top:72px;transform:translateX(-50%);
    font-size:12px;opacity:.9;text-align:center;z-index:4}

  /* プレイフィールド */
  .field{position:fixed;inset:0;overflow:hidden}

  .tane{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    display:flex;flex-direction:column;align-items:center;gap:6px;z-index:2;
  }
  .tane img{
    width:min(40vmin,220px);height:auto;
    filter:drop-shadow(0 10px 28px rgba(0,0,0,.55));
    user-select:none;pointer-events:none;
  }
  @media (max-width:480px){ .tane img{width:min(54vmin,160px)} }

  /* 名前タグ */
  .nameTag{
    margin-top:6px;
    padding:8px 14px;border-radius:12px;background:var(--glass);
    border:1px solid var(--brd);cursor:pointer;user-select:none;
    font-weight:800;box-shadow:0 8px 20px rgba(0,0,0,.35);
  }

  /* ポイントバー */
  .barwrap{position:fixed;left:50%;bottom:40px;transform:translateX(-50%);
    width:min(92vw,720px);display:flex;gap:8px;align-items:center;z-index:5}
  .bar{position:relative;flex:1;height:12px;border-radius:999px;
    background:rgba(255,255,255,.14);border:1px solid var(--brd);overflow:hidden}
  .bar>i{position:absolute;left:0;top:0;bottom:0;width:0;
    background:linear-gradient(90deg,var(--ok),#a7f3d0)}
  .pts{font-variant-numeric:tabular-nums;background:var(--glass);
    border:1px solid var(--brd);padding:6px 10px;border-radius:10px}
</style>
</head>
<body>
  <!-- HUD -->
  <div class="chips">
    <span class="chip">👤 <span id="chipPlayer">あなた</span></span>
    <span class="chip">🎨 色: <span id="chipColor">pink</span></span>
    <span class="chip">🍀 モード: タネ観察</span>
  </div>
  <div class="title">タネを観察して育てよう</div>
  <div class="subtitle">名前をクリックしてポイントをためると進化できます</div>

  <!-- プレイフィールド -->
  <div class="field">
    <div class="tane">
      <img id="taneImg" alt="tane">
      <div class="nameTag" id="nameTag"></div>
    </div>
  </div>

  <!-- ポイント -->
  <div class="barwrap">
    <div class="bar"><i id="bar"></i></div>
    <div class="pts">ポイント: <span id="pts">0</span> / <span id="th">15</span></div>
  </div>

<script>
  /* ===== 共通 util ===== */
  const read = (k, d='') => {
    const v = localStorage.getItem(k);
    return (v===null||v==='undefined'||v==='null')? d : v;
  };

  /* ===== データ ===== */
  const PLAYER_NAME = read('PLAYER_NAME','あなた');
  const CHAR_NAME   = read('CHAR_NAME','タネ');
  const COLOR       = (read('macaronColor','pink')||'pink').trim().toLowerCase();
  const THRESHOLD   = Number(read('TANE_POINTS_TO_EVOLVE','15'));
  let pts           = Number(read('tanePoints','0'));

  /* ===== DOM ===== */
  const chipPlayer=document.getElementById('chipPlayer');
  const chipColor =document.getElementById('chipColor');
  const taneImg   =document.getElementById('taneImg');
  const nameTag   =document.getElementById('nameTag');
  const barFill   =document.getElementById('bar');
  const ptsEl     =document.getElementById('pts');
  const thEl      =document.getElementById('th');

  chipPlayer.textContent=PLAYER_NAME;
  chipColor.textContent=COLOR;
  nameTag.textContent=CHAR_NAME;
  thEl.textContent=THRESHOLD;

  /* ==== タネ画像（直下から確実に読む） ==== */
  (function setTaneSrc(){
    const primary   = `tane_${COLOR}.png`;   // 例: tane_pink.png
    const fallback1 = `tane_pink.png`;       // 保険

    function trySet(src, next){
      const t=new Image();
      t.onload=()=> (taneImg.src=src);
      t.onerror=()=>{ if(next && next.length) trySet(next.shift(),next); };
      t.src=src;
    }
    trySet(primary,[fallback1]);
  })();

  /* ===== ポイント管理 ===== */
  function refreshPoints(){
    ptsEl.textContent=String(pts);
    const ratio=Math.max(0,Math.min(1,pts/THRESHOLD));
    barFill.style.width=`${ratio*100}%`;
    barFill.style.background=ratio>0.66
      ? 'linear-gradient(90deg,var(--ok),#a7f3d0)'
      : ratio>0.33
      ? 'linear-gradient(90deg,var(--warn),#fde68a)'
      : 'linear-gradient(90deg,var(--bad),#fecaca)';
  }
  function addPoints(n=1){
    pts=Math.max(0,pts+n);
    localStorage.setItem('tanePoints',String(pts));
    refreshPoints();
  }

  nameTag.addEventListener('click',()=>addPoints(1));
  document.addEventListener('keydown',e=>{if(e.key==='Enter') addPoints(1)});

  refreshPoints();
</script>
</body>
</html>
