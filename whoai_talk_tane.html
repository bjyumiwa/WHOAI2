<!-- FILE: /WHOAI2/whoai_talk_tane.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>WhoAI | ã‚¿ãƒè¦³å¯Ÿï¼ˆãŠä¸–è©±ï¼‹ãƒã‚¤ãƒ³ãƒˆâ†’ãƒã‚«ãƒ­ãƒ³ï¼‰</title>
<meta name="color-scheme" content="dark light" />
<link rel="icon"
  href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.85em' font-size='80'%3EğŸŒ±%3C/text%3E%3C/svg%3E" />
<style>
  :root{
    --glass: rgba(0,0,0,.35);
    --brd: rgba(255,255,255,.18);
    --ok:#86efac; --warn:#fde047; --bad:#fda4af;
    --ink:#fff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;overflow:hidden}
  body{
    font-family:"Noto Sans JP",system-ui,sans-serif;color:var(--ink);
    background:#000 url("space_background.png") center/cover fixed no-repeat;
  }

  /* ä¸Šéƒ¨ãƒãƒƒãƒ— */
  .chips{position:fixed;left:50%;top:8px;transform:translateX(-50%);display:flex;gap:8px;flex-wrap:wrap;justify-content:center;z-index:5}
  .chip{background:var(--glass);backdrop-filter:blur(5px);border:1px solid var(--brd);padding:6px 10px;border-radius:999px;font-size:12px}

  .title{position:fixed;left:50%;top:44px;transform:translateX(-50%);font-weight:800;text-align:center;z-index:4}
  .subtitle{position:fixed;left:50%;top:72px;transform:translateX(-50%);font-size:12px;opacity:.9;text-align:center;z-index:4}

  /* ãƒ—ãƒ¬ã‚¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼å…¨ç”»é¢ */
  .field{position:fixed;inset:0;overflow:hidden}

  /* ã‚­ãƒ£ãƒ© */
  .tane{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    display:flex;flex-direction:column;align-items:center;gap:6px;z-index:2;
  }
  .tane img{
    width:min(40vmin,220px);height:auto;filter:drop-shadow(0 10px 28px rgba(0,0,0,.55));
    user-select:none; pointer-events:none; transition:transform .18s ease;
  }
  @media (max-width:480px){ .tane img{width:min(54vmin,160px)} }
  .pop{animation:pop .25s ease}
  @keyframes pop{0%{transform:scale(1)}60%{transform:scale(1.06)}100%{transform:scale(1)}}

  /* åå‰ã‚¿ã‚° */
  .nameTag{
    position:absolute;left:50%;top:-10px;transform:translate(-50%,-100%);
    padding:8px 14px;border-radius:12px;background:var(--glass);border:1px solid var(--brd);
    cursor:pointer;user-select:none;font-weight:800;box-shadow:0 8px 20px rgba(0,0,0,.35);
    opacity:0; pointer-events:none; transition:opacity .25s ease;
  }
  .nameTag.show{opacity:1;pointer-events:auto}
  .spin{animation:spin 500ms ease both}
  @keyframes spin{to{transform:translate(-50%,-100%) rotate(360deg)}}

  /* åŠ±ã¾ã—ãƒ•ã‚­ãƒ€ã‚· */
  .bubble{
    position:absolute;left:50%;top:-14px;transform:translate(-50%,-100%);
    background:#0f1220d0;border:1px solid var(--brd);border-radius:14px;padding:10px 12px;font-size:13px;
    box-shadow:0 10px 26px rgba(0,0,0,.5);opacity:0;pointer-events:none;transition:opacity .2s ease, transform .2s ease;
  }
  .bubble.show{opacity:1;transform:translate(-50%,-110%)}

  /* ãƒã‚«ãƒ­ãƒ³è§£æ”¾ãƒãƒƒã‚¸ */
  #unlock{position:fixed;right:10px;top:10px;display:none;align-items:center;gap:6px;padding:8px 12px;border-radius:999px;background:var(--glass);border:1px solid var(--brd);cursor:pointer;z-index:6}
  #unlock:active{transform:translateY(1px)}

  /* ãƒã‚¤ãƒ³ãƒˆãƒãƒ¼ */
  .barwrap{position:fixed;left:50%;bottom:76px;transform:translateX(-50%);width:min(92vw,720px);display:flex;gap:8px;align-items:center;z-index:5}
  .bar{position:relative;flex:1;height:12px;border-radius:999px;background:rgba(255,255,255,.14);border:1px solid var(--brd);overflow:hidden}
  .bar>i{position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,var(--ok),#a7f3d0)}
  .pts{font-variant-numeric:tabular-nums;background:var(--glass);border:1px solid var(--brd);padding:6px 10px;border-radius:10px}

  /* ãŠä¸–è©±ãƒ‘ãƒãƒ« */
  .panel{position:fixed;left:50%;bottom:8px;transform:translateX(-50%);width:min(920px,96vw);display:grid;grid-template-columns:1fr;gap:8px;z-index:6}
  .care{display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
  .btncare{background:var(--glass);border:1px solid var(--brd);color:#fff;border-radius:12px;padding:8px 12px;font-weight:800;cursor:pointer;font-size:14px}
  .btncare:disabled{opacity:.55;cursor:not-allowed}
  .btnreset{background:rgba(255,255,255,.14);border:1px solid var(--brd);color:#fff;border-radius:12px;padding:8px 12px;font-weight:800;cursor:pointer}
  .gauges{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px}
  .gbar{position:relative;height:12px;border-radius:999px;background:rgba(255,255,255,.14);border:1px solid var(--brd);overflow:hidden}
  .gbar>span{position:absolute;left:0;top:0;bottom:0;width:50%;background:linear-gradient(90deg,#7ac7ff,#bfe6ff);transition:width .3s}
  .glbl{position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:11px;text-shadow:0 1px 2px rgba(0,0,0,.4)}

  /* é€²åŒ–ãƒˆãƒ¼ã‚¹ãƒˆ */
  .toast{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#0f1220;border:1px solid var(--brd);border-radius:16px;padding:14px 16px;z-index:10;display:none;box-shadow:0 18px 50px rgba(0,0,0,.5);text-align:center}
  .toast.show{display:block;animation:pop .25s ease}
</style>
</head>
<body>
  <!-- HUD -->
  <div class="chips">
    <span class="chip">ğŸ‘¤ <span id="chipPlayer">ã‚ãªãŸ</span></span>
    <span class="chip">ğŸ¨ è‰²: <span id="chipColor">pink</span></span>
    <span class="chip">ğŸ€ ãƒ¢ãƒ¼ãƒ‰: ã‚¿ãƒè¦³å¯Ÿ</span>
  </div>
  <div class="title">ã‚¿ãƒã‚’è¦³å¯Ÿã—ã¦è‚²ã¦ã‚ˆã†</div>
  <div class="subtitle">åå‰ã‚¿ãƒƒãƒã‚„ãŠä¸–è©±ã§ãƒã‚¤ãƒ³ãƒˆã‚’ãŸã‚ã‚‹ã¨ã€ãƒã‚«ãƒ­ãƒ³ã§é€²åŒ–ã§ãã¾ã™</div>

  <!-- ãƒã‚«ãƒ­ãƒ³è§£æ”¾ -->
  <div id="unlock">ğŸ¬ ãƒã‚«ãƒ­ãƒ³è§£æ”¾ï¼</div>

  <!-- ãƒ—ãƒ¬ã‚¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
  <div class="field" id="field">
    <div class="tane" id="tane">
      <div class="nameTag" id="nameTag"></div>
      <div class="bubble" id="bubble"></div>
      <img id="taneImg" alt="tane">
    </div>
  </div>

  <!-- ãƒã‚¤ãƒ³ãƒˆ -->
  <div class="barwrap">
    <div class="bar"><i id="bar"></i></div>
    <div class="pts">ãƒã‚¤ãƒ³ãƒˆ: <span id="pts">0</span> / <span id="th">15</span></div>
  </div>

  <!-- ãŠä¸–è©±ï¼‹ãƒªã‚»ãƒƒãƒˆ -->
  <div class="panel">
    <div class="care">
      <button class="btncare" id="btnToilet">ğŸš½ ãƒˆã‚¤ãƒ¬</button>
      <button class="btncare" id="btnBath">ğŸ› ãŠãµã‚</button>
      <button class="btncare" id="btnPlay">ğŸ² ã‚ãã¶</button>
      <button class="btnreset" id="btnReset">ğŸ”„ ãƒã‚¤ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <div class="gauges">
      <div class="gbar" id="gClean"><span></span><div class="glbl">ãã‚Œã„</div></div>
      <div class="gbar" id="gFun"><span></span><div class="glbl">ãŸã®ã—ã•</div></div>
      <div class="gbar" id="gRelief"><span></span><div class="glbl">ã‚¹ãƒƒã‚­ãƒª</div></div>
    </div>
  </div>

  <div class="toast" id="toast">ãƒã‚¤ãƒ³ãƒˆãŒãŸã¾ã‚Šã¾ã—ãŸï¼<br/>ãƒã‚«ãƒ­ãƒ³é¸æŠã¸é€²ã¿ã¾ã™â€¦</div>

<script>
  /* ===== åˆæœŸè¨­å®š ===== */
  const read = (k, d='') => { const v = localStorage.getItem(k); return (v===null||v==='undefined'||v==='null')? d : v; };
  const PLAYER_NAME = read('PLAYER_NAME','ã‚ãªãŸ');
  const CHAR_NAME   = read('CHAR_NAME','ã‚¿ãƒ');
  const COLOR       = (read('macaronColor','pink')||'pink').toLowerCase();
  const THRESHOLD   = Number(read('TANE_POINTS_TO_EVOLVE','15'));
  let pts           = Number(read('tanePoints','0'));

  const chipPlayer=document.getElementById('chipPlayer');
  const chipColor=document.getElementById('chipColor');
  const taneImg=document.getElementById('taneImg');
  const nameTag=document.getElementById('nameTag');
  const bubble=document.getElementById('bubble');
  const barFill=document.getElementById('bar');
  const ptsEl=document.getElementById('pts');
  const thEl=document.getElementById('th');
  const unlock=document.getElementById('unlock');
  const taneEl=document.getElementById('tane');
  const toast=document.getElementById('toast');

  chipPlayer.textContent=PLAYER_NAME;
  chipColor.textContent=COLOR;
  thEl.textContent=THRESHOLD;

  // ==== ã‚¿ãƒç”»åƒï¼ˆãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ä»˜ãï¼‰====
  (function setTaneSrc(){
    const file = `assets/stage1/tane_${COLOR}.png`;
    const t=new Image();
    t.onload=()=> (taneImg.src=file);
    t.onerror=()=> (taneImg.src="assets/stage1/tane_pink.png");
    t.src=file;
  })();

  // ==== ãƒã‚¤ãƒ³ãƒˆ ====
  function refreshPoints(){
    ptsEl.textContent=String(pts);
    const ratio=Math.max(0,Math.min(1,pts/THRESHOLD));
    barFill.style.width=`${ratio*100}%`;
    unlock.style.display=(pts>=THRESHOLD)?'inline-flex':'none';
  }
  function addPoints(n=1){
    pts=Math.max(0,pts+n);
    localStorage.setItem('tanePoints',String(pts));
    refreshPoints();
    taneImg.classList.add('pop'); setTimeout(()=>taneImg.classList.remove('pop'),250);
    if(pts>=THRESHOLD) showToastAndEvolve();
  }
  document.getElementById('btnReset').addEventListener('click',()=>{pts=0;localStorage.setItem('tanePoints','0');refreshPoints();});

  // ==== åå‰ã‚¿ãƒƒãƒ ====
  nameTag.textContent=CHAR_NAME;
  nameTag.addEventListener('click',()=>{nameTag.classList.add('spin');addPoints(1);});
  setInterval(()=>{nameTag.classList.toggle('show',Math.random()<0.5);},3000);

  // ==== åŠ±ã¾ã—ã‚»ãƒªãƒ• ====
  const LINES=['ã„ã„ãƒšãƒ¼ã‚¹ï¼','ãŒã‚“ã°ã£ã¦ã‚‹ã­','ãã®èª¿å­âœ¨','ã‚ã‚ŠãŒã¨ã†ï¼','ä¼‘æ†©ã‚‚å¤§äº‹ã ã‚ˆ','ã‚ã¨å°‘ã—ï¼','ä¸€ç·’ã«ã„ã“ã†'];
  function showBubble(){bubble.textContent=LINES[(Math.random()*LINES.length)|0];bubble.classList.add('show');setTimeout(()=>bubble.classList.remove('show'),2000);}
  setInterval(()=>{if(Math.random()<0.4) showBubble();},5000);

  // ==== é€²åŒ– ====
  function showToastAndEvolve(){toast.classList.add('show');setTimeout(()=>{localStorage.setItem("EVOLVED","1");location.href="macaron_select.html";},900);}
  unlock.addEventListener('click',showToastAndEvolve);

  (function init(){refreshPoints();})();
</script>
</body>
</html>
