<!-- FILE: /WHOAI2/evolution.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>é€²åŒ–æ¼”å‡º | WhoAI</title>
<meta name="color-scheme" content="dark light" />
<style>
  /* èƒŒæ™¯ã¯ body ã ã‘ã«ä¸€æš */
  html,body{height:100%;margin:0;overflow:hidden}
  body{
    font-family:"Noto Sans JP",system-ui,sans-serif;color:#fff;
    background:#000 url("space_background.png") center/cover fixed no-repeat;
    display:flex;align-items:center;justify-content:center;padding:12px;
  }

  /* ã‚¬ãƒ©ã‚¹é¢¨ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆèƒŒæ™¯ã¯æŒãŸã›ãªã„ï¼‰ */
  .stage{
    position:relative; width:min(92vw,860px); aspect-ratio:1/0.75;
    border-radius:24px; overflow:hidden;
    background:rgba(0,0,0,.22);
    backdrop-filter:blur(3px); -webkit-backdrop-filter:blur(3px);
    border:1px solid rgba(255,255,255,.18);
    box-shadow:0 10px 28px rgba(0,0,0,.25), inset 0 10px 28px rgba(0,0,0,.25);
  }

  /* é€²åŒ–æ¼”å‡º */
  .beam{
    position:absolute; inset:0; pointer-events:none; opacity:0;
    background:radial-gradient(60% 40% at 50% 30%, rgba(255,255,255,.45), rgba(255,255,255,0)),
               radial-gradient(40% 25% at 50% 60%, rgba(125,200,255,.35), rgba(0,0,0,0));
    mix-blend-mode:screen; filter:blur(2px);
    animation: beam 2.6s ease-out .2s both;
  }
  @keyframes beam{
    0%{opacity:0; transform:scale(1.05)}
    20%{opacity:.9}
    70%{opacity:.75}
    100%{opacity:0; transform:scale(1)}
  }

  .charWrap{
    position:absolute; left:50%; top:58%; transform:translate(-50%,-50%) scale(.7);
    filter:drop-shadow(0 12px 26px rgba(0,0,0,.5));
    animation: pop 1200ms cubic-bezier(.2,.9,.2,1.05) .4s both, breathe 6s ease-in-out 1.8s infinite;
  }
  @keyframes pop{
    0%{ transform:translate(-50%,-50%) scale(.1); opacity:0 }
    60%{ transform:translate(-50%,-50%) scale(1.1); opacity:1 }
    100%{ transform:translate(-50%,-50%) scale(1) }
  }
  @keyframes breathe{
    0%,100%{ transform:translate(-50%,-50%) scale(1) }
    50%{ transform:translate(-50%,-50%) scale(1.04) }
  }
  .charImg{ width:min(28vw,260px); max-width:42vmin; object-fit:contain }

  /* CTAï¼ˆæ¼”å‡ºå¾Œã«å‡ºç¾ï¼‰ */
  .cta{
    position:absolute; left:0; right:0; bottom:16px;
    display:flex; gap:10px; justify-content:center; flex-wrap:wrap;
    opacity:0; transform:translateY(16px);
    transition:opacity .5s ease, transform .5s ease;
  }
  .cta.show{ opacity:1; transform:none }

  .btn{
    appearance:none; border:none; border-radius:14px; cursor:pointer;
    padding:10px 14px; font-weight:800; font-size:clamp(14px,2.5vw,16px);
    box-shadow:0 6px 18px rgba(0,0,0,.28);
  }
  .btn-primary{ background:#fff; color:#111 }
  .btn-ghost{ background:rgba(255,255,255,.18); color:#fff; border:1px solid rgba(255,255,255,.28) }

  /* ä¸Šéƒ¨ã®æ¡ˆå†… */
  .head{
    position:absolute; left:0; right:0; top:10px; text-align:center;
    font-weight:700; text-shadow:0 2px 6px rgba(0,0,0,.35);
  }
</style>
</head>
<body>
  <main class="stage">
    <div class="head">é€²åŒ–ã—ãŸã‚ˆï¼</div>
    <div class="beam" aria-hidden="true"></div>
    <div class="charWrap"><img id="charImg" class="charImg" alt="evolved character" /></div>

    <!-- é€²åŒ–å¾Œã®é¸æŠè‚¢ï¼šè¦³å¯Ÿ or ä¼šè©± -->
    <div id="cta" class="cta" aria-live="polite" aria-label="æ¬¡ã®è¡Œãå…ˆã‚’é¸æŠ">
      <button id="btnObserve" class="btn btn-ghost" type="button">ğŸ‘€ è¦³å¯Ÿã‚’ã¤ã¥ã‘ã‚‹</button>
      <button id="btnTalk" class="btn btn-primary" type="button">ğŸ’¬ ä¼šè©±ã™ã‚‹ï¼ˆWhoAIï¼‰</button>
    </div>
  </main>

<script>
  // === è¨­å®š ===
  const KEY={color:'whoai_color', xp:'whoai_xp'};
  const color = localStorage.getItem(KEY.color) || 'pink';

  // ç”»åƒãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆå­˜åœ¨ã™ã‚‹ç‰©ã‚’é †ã«ï¼‰
  function setWithFallback(imgEl, candidates){
    let i=0;
    function next(){
      if(i>=candidates.length){ imgEl.style.display='none'; return; }
      const url=candidates[i++]; imgEl.onerror=next; imgEl.src=url;
    }
    next();
  }
  const candidates = [
    `/WHOAI2/evolved_${color}.png`,
    `/WHOAI2/evolved_${color}_open.png`,
    `/WHOAI2/public/assets/stage2/evolved_${color}.png`,
    `/WHOAI2/tane_${color}.png` // æœ€çµ‚æ‰‹æ®µ
  ];
  setWithFallback(document.getElementById('charImg'), candidates);

  // === æ¼”å‡ºçµ‚äº†å¾Œã«ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º ===
  const cta = document.getElementById('cta');
  const SHOW_DELAY_MS = 2600;  // beam/popupãŒçµ‚ã‚ã‚‹æ™‚é–“ã«åˆã‚ã›ã‚‹
  setTimeout(()=>cta.classList.add('show'), SHOW_DELAY_MS);

  // === è¡Œãå…ˆ ===
  // è¦³å¯Ÿãƒ¢ãƒ¼ãƒ‰ï¼ˆä¼šè©±ãªã—ï¼‰ï¼šé€²åŒ–ã‚­ãƒ£ãƒ©ã‚’çœºã‚ã‚‹ç”»é¢
  const OBSERVE_URL = 'whoai_talk_evolved.html';
  // ä¼šè©±ã—ãŸããªã£ãŸã‚‰ï¼šWhoAIã®ä¼šè©±ãƒ¢ãƒ¼ãƒ‰ã¸ï¼ˆå¿…è¦ãªã‚‰å¤‰æ›´OKï¼‰
  const TALK_URL    = 'whoai_talk.html';

  document.getElementById('btnObserve').addEventListener('click', ()=>location.href=OBSERVE_URL);
  document.getElementById('btnTalk').addEventListener('click',     ()=>location.href=TALK_URL);

  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆO=è¦³å¯Ÿ, T=ä¼šè©±ï¼‰
  addEventListener('keydown', (e)=>{
    const k=e.key.toLowerCase();
    if(k==='o') location.href=OBSERVE_URL;
    if(k==='t') location.href=TALK_URL;
  });

  // èƒŒæ™¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆç„¡ã„å ´åˆã«ã ã‘ã‚°ãƒ©ãƒ‡ï¼‰
  (function bgFallback(){
    const img=new Image(); img.onload=()=>{}; img.onerror=()=>{
      document.body.style.background='radial-gradient(1200px 600px at 65% 10%, rgba(255,255,255,.18), rgba(0,0,0,0)) #000';
    };
    img.src='space_background.png';
  })();
</script>
</body>
</html>
