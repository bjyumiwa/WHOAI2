<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- FILE: /evolution.html (進化演出 → whoai_talk_evolved.html) -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>進化の瞬間 | WhoAI</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    html,body{height:100%;margin:0}
    body{
      font-family:"Noto Sans JP",system-ui,sans-serif;color:#fff;
      background:#000 url("assets/stage1/space_background.png") center/cover fixed no-repeat;
      display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;text-align:center;overflow:hidden}

    h1{font-size:clamp(28px,6vw,56px);text-shadow:0 2px 10px rgba(0,0,0,.5)}
    .stage{position:relative;width:min(90vw,480px);aspect-ratio:1/1;display:grid;place-items:center}
    .stage img{width:100%;height:100%;object-fit:contain;opacity:0;transform:scale(0.5);animation:evo 4s forwards}

    @keyframes evo{
      0%{opacity:0;transform:scale(0.5) rotate(-20deg)}
      40%{opacity:1;transform:scale(1.15) rotate(10deg)}
      70%{opacity:1;transform:scale(0.9) rotate(-5deg)}
      100%{opacity:1;transform:scale(1) rotate(0)}
    }

    .flash{position:fixed;inset:0;background:#fff;opacity:0;pointer-events:none;animation:flash 1s ease-in-out forwards}
    @keyframes flash{0%{opacity:0}20%{opacity:.9}100%{opacity:0}}

    .note{font-size:14px;opacity:.9}
  </style>
</head>
<body>
  <h1 id="title">進化中…</h1>
  <section class="stage">
    <img id="charImg" src="" alt="evolving character" />
    <div class="flash"></div>
  </section>
  <p class="note">しばらくすると進化後のキャラと再会できます。</p>

  <script>
    const KEY={color:'whoai_color',stage:'whoai_stage'};
    const color=localStorage.getItem(KEY.color)||'pink';
    const img=document.getElementById('charImg');
    img.src=`assets/stage2/tane_${color}.png`;

    // stageをevolvedにセット
    localStorage.setItem(KEY.stage,'evolved');

    // 進化演出後、自動遷移
    setTimeout(()=>{location.href='whoai_talk_evolved.html'},4200);
  </script>
</body>
</html>
