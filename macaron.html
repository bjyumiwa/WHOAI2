<!DOCTYPE html><html lang="ja"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>マカロンを選ぶ（1回目）</title>
<style>
  html,body{height:100%;margin:0}
  body{font-family:"Noto Sans JP",system-ui,sans-serif;color:#fff;
       background:#000 url("space_background.png") center/cover fixed no-repeat;
       display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;padding:20px}
  h1{margin:0 0 6px}
  .row{display:flex;gap:16px;flex-wrap:wrap;justify-content:center}
  .m{width:96px;height:96px;border-radius:16px;border:1px solid rgba(255,255,255,.25);
     background:rgba(0,0,0,.25);padding:8px;cursor:pointer}
  .m img{width:100%;height:100%;object-fit:contain;display:block}
</style>
</head><body>
  <h1>最初のマカロンを選んでね</h1>
  <div class="row">
    <button class="m" onclick="chooseMacaron('pink',1)"><img src="macaron_pink.png" alt="ピンク"></button>
    <button class="m" onclick="chooseMacaron('blue',1)"><img src="macaron_blue.png" alt="ブルー"></button>
    <button class="m" onclick="chooseMacaron('green',1)"><img src="macaron_green.png" alt="グリーン"></button>
    <button class="m" onclick="chooseMacaron('purple',1)"><img src="macaron_purple.png" alt="パープル"></button>
  </div>

<script>
(function(){
  const K={history:"whoai_history",color:"whoai_color",stage:"whoai_stage"};
  const getHist=()=>JSON.parse(localStorage.getItem(K.history)||"[]");
  const setHist=a=>localStorage.setItem(K.history,JSON.stringify(a));
  const setStage=s=>localStorage.setItem(K.stage,s);
  const setColor=c=>localStorage.setItem(K.color,c);

  window.chooseMacaron=function(color,n){
    const hist=getHist(); setColor(color);
    if(n===1){
      setHist([color]); setStage("tane");
      location.href="whoai_talk.html"; // タネで会話（3回→既存ロジックで macaron_select.html へ）
      return;
    }
    hist.push(color); setHist(hist);
    const evolved=(hist.length>=2 && hist[0]===hist[1]);
    setStage(evolved?"evolved":"tane");
    location.href=evolved?"evolution.html":"whoai_talk.html";
  };
})();
</script>
</body></html>
