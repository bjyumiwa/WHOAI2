<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- FILE: /macaron.html (Choose macaron color; observation mode) -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>マカロンを選ぶ | WhoAI</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --glass: rgba(0,0,0,.45);
      --glass-strong: rgba(0,0,0,.6);
      --text: #fff;
      --shadow: 0 10px 40px rgba(0,0,0,.35);
      --radius: 20px;
    }
    html,body{height:100%;margin:0}
    body{
      font-family:"Noto Sans JP", system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Sans", "Yu Gothic", sans-serif;
      color:var(--text);
      background:#000 url("public/assets/stage1/space_background.png") center/cover fixed no-repeat;
      display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
      gap:18px;padding:24px;text-align:center
    }

    header{margin-top:10px}
    h1{font-size: clamp(26px, 4.8vw, 48px);margin:0 0 8px;text-shadow:0 2px 10px rgba(0,0,0,.4)}
    p.lead{margin:0;opacity:.95;line-height:1.75;font-size:clamp(14px, 2.4vw, 18px)}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:22px;max-width:720px;width:min(96vw,720px)}

    .macaron{cursor:pointer;border-radius:50%;overflow:hidden;box-shadow:var(--shadow);transition:.2s transform ease;display:flex;flex-direction:column;align-items:center;gap:6px}
    .macaron:hover{transform:translateY(-4px)}
    .macaron img{width:120px;height:120px;object-fit:cover;border-radius:50%;border:4px solid rgba(255,255,255,.5)}
    .label{font-weight:700;font-size:16px}

    .note{font-size:12px;opacity:.85;margin-top:12px}
  </style>
</head>
<body>
  <header>
    <h1 id="title">マカロンを選ぼう</h1>
    <p id="subtitle" class="lead">好きな色のマカロンをあげると、その色のキャラになります。<br>会話はしません。観察して、かわいがってね。</p>
  </header>

  <section class="grid">
    <div class="macaron" data-color="pink">
      <img src="public/assets/stage1/macaron_pink.png" alt="ピンクのマカロン" />
      <div class="label">ピンク</div>
    </div>
    <div class="macaron" data-color="blue">
      <img src="public/assets/stage1/macaron_blue.png" alt="青のマカロン" />
      <div class="label">ブルー</div>
    </div>
    <div class="macaron" data-color="green">
      <img src="public/assets/stage1/macaron_green.png" alt="緑のマカロン" />
      <div class="label">グリーン</div>
    </div>
    <div class="macaron" data-color="purple">
      <img src="public/assets/stage1/macaron_purple.png" alt="紫のマカロン" />
      <div class="label">パープル</div>
    </div>
  </section>

  <p class="note">選んだ色は記録され、キャラクターの姿に反映されます。</p>

  <script>
    const KEY = {
      color: 'whoai_color',
      stage: 'whoai_stage',
      intent: 'whoai_rebirth_intent'
    };

    function saveColorAndNext(color){
      localStorage.setItem(KEY.color, color);
      localStorage.setItem(KEY.stage, 'tane'); // 初期はタネ状態
      const intent = localStorage.getItem(KEY.intent);
      if(intent==='recolor'){
        // rebirthからの姿変更なら → evolution → 観察トークへ
        localStorage.removeItem(KEY.intent);
        location.href = 'evolution.html';
      }else{
        // 通常フローならタネ観察画面へ
        location.href = 'whoai_talk.html';
      }
    }

    document.querySelectorAll('.macaron').forEach(el => {
      el.addEventListener('click', () => saveColorAndNext(el.dataset.color));
    });
  </script>
</body>
</html>
