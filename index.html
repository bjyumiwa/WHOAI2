<!-- FILE: /index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhoAI 2 | Welcome</title>
  <meta name="description" content="WHOAI2: 人工知能と人間の関係性を考える研究型アプリケーション" />
  <style>
    :root{
      --bg-blur: blur(3px);
      --card-bg: rgba(0,0,0,.38);
      --card-bd: rgba(255,255,255,.18);
      --text:#fff;
      --accent:#f7b0bf;
      --accent-ink:#222;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:"Noto Sans JP",system-ui,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Noto Color Emoji","Segoe UI Emoji",sans-serif;
      color:var(--text);
      background:#000 center/cover fixed no-repeat;
      background-image:url("space_background.png");
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:24px;
    }
    .hero{
      width:min(92vw, 860px);
      text-align:center;
      padding:32px 20px 28px;
      background:linear-gradient(transparent,rgba(0,0,0,.25));
      border-radius:20px;
    }
    h1{
      margin:0 0 14px;
      font-size:clamp(28px,5vw,44px);
      letter-spacing:.02em;
      text-shadow:0 2px 10px rgba(0,0,0,.6);
    }
    .lead{
      margin:0 auto 20px;
      width:min(90%, 740px);
      font-size:clamp(15px,2.2vw,18px);
      line-height:1.9;
      text-shadow:0 1px 6px rgba(0,0,0,.55);
    }
    .cta{
      display:flex;gap:10px;justify-content:center;flex-wrap:wrap
    }
    .primary,.ghost{
      padding:.9rem 1.3rem;border:0;border-radius:14px;cursor:pointer;
      font-weight:800;box-shadow:0 6px 18px rgba(0,0,0,.35);transition:transform .06s ease;
    }
    .primary{ background:var(--accent); color:var(--accent-ink); }
    .ghost{ background:rgba(255,255,255,.08); color:#fff; border:1px solid rgba(255,255,255,.22) }
    .primary:active,.ghost:active{ transform:translateY(1px) }

    .lang{ margin-top:14px; font-size:14px; opacity:.95; user-select:none; }
    .lang button{ background:none;border:0;color:#fff;text-decoration:underline;cursor:pointer;padding:2px 4px;margin:0 2px }

    .about-panel{
      position:fixed; bottom:92px; right:20px; width:min(92vw, 520px); max-height:72vh; overflow:auto;
      background:var(--card-bg); -webkit-backdrop-filter:var(--bg-blur); backdrop-filter:var(--bg-blur);
      border:1px solid var(--card-bd); border-radius:14px; padding:16px 16px 18px; box-shadow:0 14px 30px rgba(0,0,0,.45);
      display:none; z-index:999;
    }
    .about-panel.open{ display:block }
    .about-panel h2{ margin:14px 0 8px;font-size:20px }
    .panel{
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      border-radius:12px; padding:12px 14px; margin:10px 0;
    }
    .about-panel ul{ margin:.2em 0 .2em 1.2em } .about-panel li{ margin:.25em 0 }
    .about-close{ position:sticky; top:-6px; float:right; background:none;border:0;color:#fff;font-size:22px;cursor:pointer }
    .about-toggle{
      position:fixed; bottom:20px; right:20px; width:54px; height:54px; border-radius:50%;
      background:var(--accent); color:var(--accent-ink); font-weight:900; font-size:22px; border:0; cursor:pointer;
      box-shadow:0 8px 20px rgba(0,0,0,.45); z-index:1000;
    }
    .note{font-size:12px;opacity:.8;margin-top:10px}
  </style>
</head>
<body>

  <div class="hero" role="banner" aria-label="WhoAI 2 hero">
    <h1 id="t_title">WhoAIへようこそ</h1>
    <p id="t_desc" class="lead">まずはタネのタイプを選んで、名前を付けてから育てよう。ポイントが貯まるとマカロンで進化！</p>

    <div class="cta">
      <!-- Start: インデックスから seed_select.html へ -->
      <button id="t_start" class="primary" onclick="location.href='seed_select.html'">はじめる（タネを選ぶ）</button>
      <!-- 続きから（名前がある場合のみ表示） -->
      <button id="t_continue" class="ghost" style="display:none" onclick="continueFlow()">つづきから</button>
    </div>

    <div class="lang" aria-label="language switch">
      <button type="button" onclick="setLang('ja')">日本語</button> |
      <button type="button" onclick="setLang('en')">English</button> |
      <button type="button" onclick="setLang('zh-CN')">简体</button> |
      <button type="button" onclick="setLang('zh-TW')">繁體</button> |
      <button type="button" onclick="setLang('ko')">한국어</button>
      <div class="note" id="t_note">言語設定は次回アクセス時も保持されます。</div>
    </div>
  </div>

  <aside id="aboutPanel" class="about-panel" aria-live="polite" aria-hidden="true">
    <button class="about-close" aria-label="close" onclick="toggleAbout()">×</button>
    <div id="aboutContent"></div>
  </aside>

  <button id="aboutToggle" class="about-toggle" onclick="toggleAbout()" aria-expanded="false" aria-controls="aboutPanel">i</button>

  <script>
    /* ========= i18n ========= */
    const I18N = {
      ja:{ title:"WhoAIへようこそ",
        desc:"まずはタネのタイプを選んで、名前を付けてから育てよう。ポイントが貯まるとマカロンで進化！",
        start:"はじめる（タネを選ぶ）", cont:"つづきから",
        note:"言語設定は次回アクセス時も保持されます。",
        about: `
<p>本プロジェクト「WHOAI2」は、<strong>人工知能と人間の関係性</strong>を探る研究型アプリです。対話・成長・再生を通じて<strong>自己同一性</strong>を考えます。</p>
<p>再生時には<strong>容姿を残す／記憶を残す</strong>を選択します。その選択は「同じ存在」かという問いを投げかけます。</p>
<h2>研究目的</h2>
<div class="panel"><p>AIとの関わりを通じて、人はどのように「個の連続性」を感じるのか。<strong>命名による愛着</strong>にも焦点を当てます。</p></div>
<h2>技術構成</h2>
<div class="panel"><ul><li>HTML/CSS/JavaScript</li><li>OpenAI API</li><li>Web Speech/Synthesis API</li><li>localStorage</li></ul></div>
<h2>倫理</h2>
<div class="panel"><p>会話履歴はブラウザにのみ保存。<strong>個人情報は収集しません。</strong></p></div>` },
      en:{ title:"Welcome to WhoAI",
        desc:"Pick a seed type first, then name and raise it. Earn points to evolve with a macaron!",
        start:"Start (Pick a seed)", cont:"Continue",
        note:"Your language preference is saved for next time.",
        about: `
<p>“WHOAI2” explores the <strong>human–AI relationship</strong> via dialogue, growth, and rebirth, inviting reflection on <strong>personal identity</strong>.</p>
<h2>Research Goal</h2>
<div class="panel"><p>We study how appearance/memory and <strong>naming-based attachment</strong> shape perceived continuity of self.</p></div>
<h2>Tech</h2>
<div class="panel"><ul><li>HTML/CSS/JS</li><li>OpenAI API</li><li>Web Speech/Synthesis</li><li>localStorage</li></ul></div>
<h2>Ethics</h2>
<div class="panel"><p>Conversation logs stay in your browser. <strong>No personal/location data collected.</strong></p></div>` },
      "zh-CN":{ title:"欢迎来到 WhoAI",
        desc:"先选择种子类型，然后命名并开始养成。积分累积后可用马卡龙进化！",
        start:"开始（选择种子）", cont:"继续",
        note:"语言偏好会被保存以便下次访问。",
        about: `
<p>“WHOAI2” 通过对话、成长与再生来探索<strong>人类与AI的关系</strong>与<strong>身份连续性</strong>。</p>
<div class="panel"><p>我们关注外貌/记忆与<strong>命名所带来的依恋</strong>如何影响“同一性”。</p></div>` },
      "zh-TW":{ title:"歡迎來到 WhoAI",
        desc:"先選擇種子類型，接著命名並開始培育。累積點數後可用馬卡龍進化！",
        start:"開始（選擇種子）", cont:"繼續",
        note:"語言偏好會在下次造訪時沿用。",
        about: `
<p>「WHOAI2」透過對話、成長與再生，探索<strong>人類與AI的關係</strong>以及<strong>自我同一性</strong>。</p>
<div class="panel"><p>我們也關注<strong>命名帶來的依附</strong>如何影響「連續性」。</p></div>` },
      ko:{ title:"WhoAI에 오신 것을 환영해요",
        desc:"먼저 씨앗 타입을 고르고 이름을 지어 키워 보세요. 포인트가 쌓이면 마카롱으로 진화!",
        start:"시작하기 (씨앗 고르기)", cont:"이어하기",
        note:"언어 설정은 다음 방문에도 유지됩니다.",
        about: `
<p>“WHOAI2”는 대화·성장·환생을 통해 <strong>인간–AI 관계</strong>와 <strong>정체성의 연속성</strong>을 탐구합니다.</p>
<div class="panel"><p><strong>작명으로 생기는 애착</strong>에도 주목합니다.</p></div>` }
    };

    const el = {
      title: document.getElementById('t_title'),
      desc: document.getElementById('t_desc'),
      start: document.getElementById('t_start'),
      cont:  document.getElementById('t_continue'),
      note:  document.getElementById('t_note'),
      about: document.getElementById('aboutContent'),
      panel: document.getElementById('aboutPanel'),
      toggle:document.getElementById('aboutToggle')
    };

    function toggleAbout(){
      const isOpen = el.panel.classList.toggle('open');
      el.toggle.setAttribute('aria-expanded', String(isOpen));
      el.panel.setAttribute('aria-hidden', String(!isOpen));
    }

    // 言語コードの互換（whoai_lang → lang へ移行）
    function migrateLangKey(){
      const old = localStorage.getItem('whoai_lang');
      if(old && !localStorage.getItem('lang')){
        // 旧 zh/tw を新 zh-CN/zh-TW に寄せる
        const map = { zh:'zh-CN', tw:'zh-TW' };
        localStorage.setItem('lang', map[old] || old);
      }
    }

    function applyLang(code){
      const t = I18N[code] || I18N['ja'];
      el.title.textContent = t.title;
      el.desc.textContent  = t.desc;
      el.start.textContent = t.start;
      el.note.textContent  = t.note;
      el.about.innerHTML   = t.about;

      // 保存（新旧どちらも保持して下流互換）
      localStorage.setItem('lang', code);
      // whoai_lang は簡易互換：zh-CN→zh, zh-TW→tw, それ以外は同一
      const legacy = code === 'zh-CN' ? 'zh' : code === 'zh-TW' ? 'tw' : code;
      localStorage.setItem('whoai_lang', legacy);

      // <html lang> も更新
      const htmlLang = code==='zh-TW' ? 'zh-Hant' : code==='zh-CN' ? 'zh-Hans' : code;
      document.documentElement.lang = htmlLang;
    }

    function setLang(code){ applyLang(code); }

    // 「つづきから」ボタン：進行状況に応じて最適な画面へ
    function continueFlow(){
      const seed  = localStorage.getItem('seedType');
      const named = localStorage.getItem('yourName') || localStorage.getItem('PLAYER_NAME');
      const xp    = Number(localStorage.getItem('whoai_xp') || localStorage.getItem('tanePoints') || 0);
      const evolvedReady = xp >= Number(localStorage.getItem('TANE_POINTS_TO_EVOLVE') || 15);

      if(!seed){ location.href = 'seed_select.html'; return; }
      if(!named){ location.href = 'naming.html'; return; }
      if(evolvedReady){ location.href = 'macaron_select.html'; return; }
      location.href = 'whoai_talk_tane.html';
    }

    // 初期化
    (function init(){
      migrateLangKey();

      // 保存済み言語 or ブラウザ言語
      const saved = localStorage.getItem('lang');
      if(saved){ applyLang(saved); }
      else{
        const nav = (navigator.language || 'ja').toLowerCase();
        if(nav.startsWith('ja')) applyLang('ja');
        else if(nav.startsWith('ko')) applyLang('ko');
        else if(nav.startsWith('zh-hant')||nav.startsWith('zh-tw')||nav.startsWith('zh-hk')) applyLang('zh-TW');
        else if(nav.startsWith('zh')) applyLang('zh-CN');
        else applyLang('en');
      }
