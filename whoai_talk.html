<!-- FILE: /whoai_talk.htmlï¼ˆã«ã‚‡ãã£ã¨å‡ºç¾â†’ç”»é¢å›éŠï¼‹å®‰å…¨ãƒœã‚¿ãƒ³ï¼‰-->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è¦³å¯Ÿãƒ¢ãƒ¼ãƒ‰ | WhoAIï¼ˆã‚¿ãƒï¼‰</title>
<meta name="color-scheme" content="dark light" />
<style>
  /* 1ç”»é¢ãƒ»èƒŒæ™¯ã ã‘è¦‹ã›ã‚‹ï¼ˆé»’å¸¯ãªã—ï¼‰ */
  html,body{height:50%;margin:0;overflow:hidden}
  body{
    font-family:"Noto Sans JP",system-ui,sans-serif;
    color:#fff;
    background:#000 url("space_background.png") center/cover no-repeat fixed;
    display:flex;align-items:center;justify-content:center;
  }

  /* èˆå°ã¯å®Œå…¨é€æ˜ã€‚å½±ã ã‘ã†ã£ã™ã‚‰ã€‚ */
  .stage{
    position:relative;
    width:min(92vw,720px);
    aspect-ratio:1;
    border-radius:22px;
    background:transparent;            /* â† é»’å¸¯ã‚’æ¶ˆã™ */
    overflow:hidden;
    box-shadow:0 8px 28px rgba(0,0,0,.28);
  }

 

  /* ã‚­ãƒ£ãƒ©ã®ãƒ©ãƒƒãƒ‘ï¼šå‡ºç¾ï¼ˆemergeï¼‰â†’ å›éŠï¼ˆroamPathï¼‰ */
  .charWrap{
    position:absolute;left:50%;top:82%;                 /* åœ°å¹³ç·šä¸Šã‹ã‚‰å‡ºã‚‹ */
    transform:translate(-50%,0) translateY(120%);        /* åœ°å¹³ç·šã®ä¸‹ã«éš ã—ã¦ãŠã */
    z-index:2;                                           /* åœ°å¹³ç·šã‚ˆã‚ŠèƒŒé¢ã«é…ç½® */
    animation:
      emerge 1600ms cubic-bezier(.17,.84,.25,1) 200ms 1 forwards,
      roamPath 38s ease-in-out 2s infinite alternate;    /* å‡ºç¾å¾Œã«å›éŠé–‹å§‹ */
  }

  /* å®Ÿéš›ã®ç”»åƒï¼ˆãµã‚ãµã‚ã®å°ã‚†ã‚‰ãã¯ã“ã“ã§ï¼‰ */
  .charImg{
    width:min(48vw,320px);
    object-fit:contain;
    filter:drop-shadow(0 10px 22px rgba(0,0,0,.35));
    pointer-events:none;
    animation:bob 7s ease-in-out infinite;
  }

  /* æ¼‚ã†UIï¼ˆç‹¬ã‚Šè¨€ï¼æ¼‚ã†ãƒã‚«ãƒ­ãƒ³ï¼‰ã€‚ã‚­ãƒ£ãƒ©ã¨ã¯é›¢ã™ */
  .ui{
    position:absolute;
    font-size:.9rem;
    padding:6px 12px;border-radius:12px;
    opacity:.8;z-index:5;
    transition:left 1.2s ease, top 1.2s ease, opacity .4s ease;
    user-select:none;-webkit-user-select:none;
  }
  .bubble{ background:rgba(0,0,0,.55); color:#fff; }
  .floatBtn{ background:rgba(255,255,255,.75); color:#111; font-weight:700; border:none; cursor:pointer; }

  /* å³ä¸‹ã®å›ºå®šâ€œä¿é™ºâ€ãƒœã‚¿ãƒ³ï¼ˆå¿…ãšæŠ¼ã›ã‚‹ï¼‰ */
  .safety{ position:fixed; right:14px; bottom:14px; z-index:10;
           background:rgba(255,255,255,.9); color:#111; border:none; border-radius:14px;
           padding:9px 14px; font-weight:700; font-size:.95rem; cursor:pointer;
           box-shadow:0 6px 18px rgba(0,0,0,.28); }

  /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ---------------------- */
  @keyframes emerge{               /* åœ°å¹³ç·šã®ä¸‹ â†’ ã™ã£ã¨å‡ºã‚‹ */
    0%   { transform:translate(-50%,0) translateY(120%); opacity:0; }
    70%  { transform:translate(-50%,0) translateY(-6%);  opacity:1; }
    100% { transform:translate(-50%,0) translateY(0);    opacity:1; }
  }
  @keyframes bob{                  /* å°ã•ãªä¸Šä¸‹æºã‚Œ */
    0%,100%{ transform:translateY(-8px) }
    50%   { transform:translateY(  8px) }
  }
  /* ç”»é¢ä¸­ã‚’ã‚†ã£ãã‚Šå›éŠï¼ˆleft/topï¼…ã‚’ã‚†ã£ãã‚Šå·¡å›ï¼‰*/
  @keyframes roamPath{
    0%   { left:18%; top:72%; }
    20%  { left:35%; top:58%; }
    40%  { left:72%; top:64%; }
    60%  { left:66%; top:28%; }
    80%  { left:28%; top:30%; }
    100% { left:18%; top:72%; }
  }
</style>
</head>
<body>
  <section class="stage" aria-live="polite">
    <div class="horizon" aria-hidden="true"></div>

    <!-- ã«ã‚‡ãã£ã¨å‡ºã¦ã€ãã®å¾Œã¯ roamPath ã§ç”»é¢ä¸­ã‚’å›éŠ -->
    <div class="charWrap">
      <img id="charImg" class="charImg" src="" alt="tane character" />
    </div>

    <div id="bubble" class="ui bubble"></div>
    <button id="floatFeedBtn" class="ui floatBtn" type="button">ğŸ¬ ãƒã‚«ãƒ­ãƒ³ã‚’ã‚ã’ã‚‹</button>
  </section>

  <!-- ã©ã‚“ãªæ™‚ã§ã‚‚æŠ¼ã›ã‚‹ä¿é™ºãƒœã‚¿ãƒ³ -->
  <button id="safetyBtn" class="safety" type="button">ğŸ¬ ãƒã‚«ãƒ­ãƒ³</button>

<script>
  // ------- è¨­å®š -------
  const KEY={color:'whoai_color',xp:'whoai_xp'};
  const I18N={ja:{lines:['ãµã‚ãµã‚â€¦â€¦','ãã‚‰ã‚Šâ˜…','ã™ã‚„â€¦â€¦','â€¦â€¦']}};
  const XP_TO_EVOLVE=3;

  // ç”»åƒ
  const color = localStorage.getItem(KEY.color)||'pink';
  document.getElementById('charImg').src = `/WHOAI2/tane_${color}.png`;

  // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚µã‚¤ã‚º
  const stage = document.querySelector('.stage');
  let W=stage.offsetWidth, H=stage.offsetHeight;
  addEventListener('resize', ()=>{ W=stage.offsetWidth; H=stage.offsetHeight; });

  // ã‚­ãƒ£ãƒ©ä¸­å¿ƒï¼ˆå®Ÿè³ª .charWrap ã®ç¾åœ¨ä½ç½®ä»˜è¿‘ï¼‰ã¨è·é›¢ã‚’å–ã‚‹ãŸã‚ã®è¿‘æ¥åˆ¤å®š
  function charCenter(){
    const wrap = document.querySelector('.charWrap').getBoundingClientRect();
    const s = stage.getBoundingClientRect();
    return { x: wrap.left - s.left + wrap.width/2, y: wrap.top - s.top + wrap.height/2 };
  }
  function farPos(minDistPx, margin=14){
    const cx=charCenter().x, cy=charCenter().y;
    let x,y,guard=0;
    do{
      x = Math.random()*(W - margin*2) + margin;
      y = Math.random()*(H - margin*2) + margin;
      guard++; if(guard>200) break;
    }while(Math.hypot(x-cx,y-cy) < minDistPx);
    return {left:x, top:y};
  }

  // ç‹¬ã‚Šè¨€ï¼ˆå‡ºæ²¡ï¼‰
  const bubble = document.getElementById('bubble');
  const lines = I18N.ja.lines;
  function r(a){ return a[Math.floor(Math.random()*a.length)] }
  function showLine(t){
    bubble.textContent=t;
    bubble.style.opacity=.9;
    const p = farPos(140);
    bubble.style.left=p.left+'px';
    bubble.style.top =p.top +'px';
    setTimeout(()=>bubble.style.opacity=0, 2000);
  }
  setTimeout(()=>showLine(r(lines)), 2200);              // ã«ã‚‡ãã£ã¨å¾Œã«åˆå›
  setInterval(()=>showLine(r(lines)), 4200);

  // ãƒã‚«ãƒ­ãƒ³ï¼šæ¼‚ã†ãƒœã‚¿ãƒ³ï¼‹å³ä¸‹å›ºå®šãƒœã‚¿ãƒ³
  const floatBtn = document.getElementById('floatFeedBtn');
  const safetyBtn= document.getElementById('safetyBtn');
  let xp = parseInt(localStorage.getItem(KEY.xp)||'0',10);
  function save(){ localStorage.setItem(KEY.xp,String(xp)); }
  function placeFloatBtn(){
    const p = farPos(160);
    floatBtn.style.left=p.left+'px';
    floatBtn.style.top =p.top +'px';
  }
  setTimeout(placeFloatBtn, 2300);                       // ã«ã‚‡ãã£ã¨å¾Œã«é…ç½®

  function feed(){
    xp++; save();
    showLine('ã±ã‚ã£ï¼');
    placeFloatBtn();
    if(xp>=XP_TO_EVOLVE){
      setTimeout(()=>location.href='macaron_select.html',700);
    }
  }
  floatBtn.addEventListener('click', feed);
  safetyBtn.addEventListener('click', feed);
  addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='m') feed(); });
</script>
</body>
</html>
