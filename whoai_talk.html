<!-- FILE: /whoai_talk.html （タネ観察モード）-->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>観察モード | WhoAI（タネ）</title>
<style>
html,body{height:100%;margin:0}
body{font-family:"Noto Sans JP",system-ui,sans-serif;color:#fff;background:#000 url("assets/stage1/space_background.png") center/cover fixed no-repeat;display:flex;flex-direction:column;align-items:center;gap:10px;padding:10px}
.stage{width:min(90vw,680px);aspect-ratio:1/1;border-radius:24px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.35);display:grid;place-items:center}
.stage img{width:85%;height:85%;object-fit:contain;animation:float 5s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.log{width:min(96vw,980px);max-height:40vh;overflow:auto;display:flex;flex-direction:column;gap:8px;padding:10px}
.bubble{align-self:center;max-width:720px;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.12);border-radius:18px;padding:10px 14px}
.controls{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
.btn{appearance:none;border:0;cursor:pointer;border-radius:16px;padding:12px 16px;font-weight:900;background:linear-gradient(135deg,#9df,#fcf);color:#111}
.meter{height:10px;width:min(96vw,420px);border-radius:999px;background:rgba(255,255,255,.15);overflow:hidden}
.fill{height:100%;width:0;background:linear-gradient(90deg,#9df,#bdff9d);transition:width .35s ease}
</style>
</head>
<body>
<main>
<section class="stage" aria-live="polite">
<img id="charImg" src="" alt="tane character" />
</section>
<div class="meter"><div id="xpFill" class="fill"></div></div>
<section class="controls">
<button id="feedBtn" class="btn">🍬 マカロンをあげる</button>
<button id="restBtn" class="btn">💤 観察する（自動）</button>
</section>
<section id="log" class="log" aria-live="polite"></section>
</main>
<script>
const KEY={lang:'whoai_lang',color:'whoai_color',xp:'whoai_xp',log:'whoai_log',stage:'whoai_stage'};
const I18N={ja:{feed:'🍬 マカロンをあげる',rest:'💤 観察する（自動）',lines:['…… きょろ きょろ','ふわふわ……','（あなたを見上げている）','きらり★','すや……'],react:['ぱあっ！','もぐもぐ','ぴょん！','にこっ'],evoReady:'そろそろ変化の予感……',evoGo:'進化の気配が満ちた！ 次へ'}};
function r(a){return a[Math.floor(Math.random()*a.length)]}
const img=document.getElementById('charImg');const logEl=document.getElementById('log');const xpFill=document.getElementById('xpFill');const feedBtn=document.getElementById('feedBtn');const restBtn=document.getElementById('restBtn');
localStorage.setItem(KEY.stage,'tane');
const color=localStorage.getItem(KEY.color)||'pink';
img.src=`assets/stage2/tane_${color}.png`;
let xp=parseInt(localStorage.getItem(KEY.xp)||'0',10);const XP_TO_EVOLVE=3;function saveXP(){localStorage.setItem(KEY.xp,String(xp))}
function setFill(){xpFill.style.width=Math.min(100,Math.round((xp/XP_TO_EVOLVE)*100))+"%"}setFill();
function pushLine(t){const b=document.createElement('div');b.className='bubble';b.textContent=t;logEl.appendChild(b);logEl.scrollTop=logEl.scrollHeight;try{const arr=JSON.parse(localStorage.getItem(KEY.log)||'[]');arr.push({t:Date.now(),s:'sys',msg:t});localStorage.setItem(KEY.log,JSON.stringify(arr).slice(-5000))}catch(e){} }
let autoTimer=setInterval(()=>pushLine(r(I18N.ja.lines)),4500);
feedBtn.addEventListener('click',()=>{pushLine(r(I18N.ja.react));xp++;setFill();saveXP();if(xp===XP_TO_EVOLVE-1)pushLine(I18N.ja.evoReady);if(xp>=XP_TO_EVOLVE){pushLine(I18N.ja.evoGo);setTimeout(()=>location.href='macaron_select.html',1200)}});
restBtn.addEventListener('click',()=>{clearInterval(autoTimer);autoTimer=setInterval(()=>pushLine(r(I18N.ja.lines)),4500)});
pushLine(r(I18N.ja.lines));
</script>
</body>
</html>
