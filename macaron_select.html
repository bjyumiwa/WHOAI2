<!-- FILE: /macaron_select.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhoAI | マカロンを選ぶ（進化）</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --glass: rgba(0,0,0,.35);
      --brd: rgba(255,255,255,.18);
      --ok:#86efac;--warn:#fde047;--bad:#fda4af
    }
    html,body{height:100%;margin:0}
    body{
      font-family:"Noto Sans JP",system-ui,sans-serif;color:#fff;
      background:#000 url("space_background.png") center/cover fixed no-repeat;
      display:flex;flex-direction:column;align-items:center;gap:10px;padding:14px
    }
    .chips{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center}
    .chip{background:var(--glass);backdrop-filter:blur(4px);border:1px solid var(--brd);padding:6px 10px;border-radius:999px;font-size:12px}
    .title{font-size:26px;font-weight:800;letter-spacing:.06em;margin-top:2px;text-align:center}
    .subtitle{font-size:12px;opacity:.9;margin-top:-4px;text-align:center}

    .grid{display:grid;grid-template-columns:repeat(4,minmax(120px,1fr));gap:14px;margin:10px auto;width:min(980px,96vw)}
    .card{position:relative;display:flex;flex-direction:column;align-items:center;gap:8px;padding:14px;border-radius:18px;background:var(--glass);border:1px solid var(--brd);cursor:pointer;outline:none;user-select:none}
    .card:focus-visible{box-shadow:0 0 0 3px #fff6}
    .card img{width:120px;max-width:42vw;height:auto;filter:drop-shadow(0 10px 24px rgba(0,0,0,.5))}
    .name{font-weight:800}
    .desc{font-size:12px;opacity:.88;text-align:center}
    .badge{position:absolute;left:10px;top:10px;background:rgba(0,0,0,.45);border:1px solid var(--brd);padding:4px 8px;border-radius:10px;font-size:12px}

    .nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    .ghostbtn{background:var(--glass);border:1px solid var(--brd);color:#fff;border-radius:12px;padding:8px 12px;cursor:pointer}

    @media (max-width:780px){.grid{grid-template-columns:repeat(2,minmax(140px,1fr))}}
    @media (max-width:420px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="chips">
    <span class="chip">👤 <span id="chipPlayer">あなた</span></span>
    <span class="chip">現在の色: <span id="chipColor">pink</span></span>
    <span class="chip">進化のキー：マカロン</span>
  </div>
  <div class="title">進化のためのマカロンを選ぼう</div>
  <div class="subtitle">選んだ色に合わせてキャラが進化します。あとで色を変えてもOK。</div>

  <div class="grid">
    <button class="card" id="pick-pink"   onclick="choose('pink')"   aria-label="ピンクのマカロン">
      <span class="badge">桃 🍑</span>
      <img src="macaron_pink.png" alt="ピンクのマカロン">
      <div class="name">ピンク</div>
      <div class="desc">やさしくて甘めの性格に進化</div>
    </button>

    <button class="card" id="pick-green"  onclick="choose('green')"  aria-label="グリーンのマカロン">
      <span class="badge">葉っぱ 🍃</span>
      <img src="macaron_green.png" alt="グリーンのマカロン">
      <div class="name">グリーン</div>
      <div class="desc">落ち着きと回復が得意な性格に進化</div>
    </button>

    <button class="card" id="pick-blue"   onclick="choose('blue')"   aria-label="ブルーのマカロン">
      <span class="badge">青い絵の具 🎨</span>
      <img src="macaron_blue.png" alt="ブルーのマカロン">
      <div class="name">ブルー</div>
      <div class="desc">クールで知的な性格に進化</div>
    </button>

    <button class="card" id="pick-purple" onclick="choose('purple')" aria-label="パープルのマカロン">
      <span class="badge">ぶどう 🍇</span>
      <img src="macaron_purple.png" alt="パープルのマカロン">
      <div class="name">パープル</div>
      <div class="desc">ミステリアスで想像力豊かな性格に進化</div>
    </button>
  </div>

  <div class="nav">
    <button class="ghostbtn" onclick="location.href='whoai_talk_tane.html'">🔙 戻る（タネ観察）</button>
    <button class="ghostbtn" onclick="location.href='index.html'">🏠 ホーム</button>
  </div>

<script>
  // 共有表示
  const read = (k,d='')=>{const v=localStorage.getItem(k);return (v===null||v==='undefined'||v==='null')?d:v};
  document.getElementById('chipPlayer').textContent = read('PLAYER_NAME', read('whoai_player_name','あなた'));
  document.getElementById('chipColor').textContent  = (read('macaronColor','pink')||'pink').toLowerCase();

  // 選択処理：色を保存→進化フラグ→演出画面へ
  function choose(color){
    localStorage.setItem('macaronColor', color);
    localStorage.setItem('EVOLVED','1');
    localStorage.setItem('EVOLVED_AT', String(Date.now()));

    // 進化後に使う軽い初期化（会話回数/ログなどは進化後ページで個別管理）
    const uid = localStorage.getItem('whoai_userId');
    if(uid){
      try{
        localStorage.removeItem(`whoai:evolved:${uid}:evolved_conversation:chatLog`);
        localStorage.removeItem(`whoai:evolved:${uid}:evolved_conversation:turn`);
      }catch{}
    }

    // 進化演出へ
    location.href = 'evolution.html';
  }

  // キーボード操作（Enterで決定）
  document.querySelectorAll('.card').forEach((el)=>{
    el.tabIndex = 0;
    el.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); el.click(); } });
  });
</script>
</body>
</html>
