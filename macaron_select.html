<!-- FILE: /macaron_select.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhoAI | ãƒã‚«ãƒ­ãƒ³ã‚’é¸ã¶ï¼ˆé€²åŒ–ï¼‰</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --glass: rgba(0,0,0,.35);
      --brd: rgba(255,255,255,.18);
      --ok:#86efac;--warn:#fde047;--bad:#fda4af
    }
    html,body{height:100%;margin:0}
    body{
      font-family:"Noto Sans JP",system-ui,sans-serif;color:#fff;
      background:#000 url("space_background.png") center/cover fixed no-repeat;
      display:flex;flex-direction:column;align-items:center;gap:10px;padding:14px
    }
    .chips{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center}
    .chip{background:var(--glass);backdrop-filter:blur(4px);border:1px solid var(--brd);padding:6px 10px;border-radius:999px;font-size:12px}
    .title{font-size:26px;font-weight:800;letter-spacing:.06em;margin-top:2px;text-align:center}
    .subtitle{font-size:12px;opacity:.9;margin-top:-4px;text-align:center}

    .grid{display:grid;grid-template-columns:repeat(4,minmax(120px,1fr));gap:14px;margin:10px auto;width:min(980px,96vw)}
    .card{position:relative;display:flex;flex-direction:column;align-items:center;gap:8px;padding:14px;border-radius:18px;background:var(--glass);border:1px solid var(--brd);cursor:pointer;outline:none;user-select:none}
    .card:focus-visible{box-shadow:0 0 0 3px #fff6}
    .card img{width:120px;max-width:42vw;height:auto;filter:drop-shadow(0 10px 24px rgba(0,0,0,.5))}
    .name{font-weight:800}
    .desc{font-size:12px;opacity:.88;text-align:center}
    .badge{position:absolute;left:10px;top:10px;background:rgba(0,0,0,.45);border:1px solid var(--brd);padding:4px 8px;border-radius:10px;font-size:12px}

    .nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    .ghostbtn{background:var(--glass);border:1px solid var(--brd);color:#fff;border-radius:12px;padding:8px 12px;cursor:pointer}

    @media (max-width:780px){.grid{grid-template-columns:repeat(2,minmax(140px,1fr))}}
    @media (max-width:420px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="chips">
    <span class="chip">ğŸ‘¤ <span id="chipPlayer">ã‚ãªãŸ</span></span>
    <span class="chip">ç¾åœ¨ã®è‰²: <span id="chipColor">pink</span></span>
    <span class="chip">é€²åŒ–ã®ã‚­ãƒ¼ï¼šãƒã‚«ãƒ­ãƒ³</span>
  </div>
  <div class="title">é€²åŒ–ã®ãŸã‚ã®ãƒã‚«ãƒ­ãƒ³ã‚’é¸ã¼ã†</div>
  <div class="subtitle">é¸ã‚“ã è‰²ã«åˆã‚ã›ã¦ã‚­ãƒ£ãƒ©ãŒé€²åŒ–ã—ã¾ã™ã€‚ã‚ã¨ã§è‰²ã‚’å¤‰ãˆã¦ã‚‚OKã€‚</div>

  <div class="grid">
    <button class="card" id="pick-pink"   onclick="choose('pink')"   aria-label="ãƒ”ãƒ³ã‚¯ã®ãƒã‚«ãƒ­ãƒ³">
      <span class="badge">æ¡ƒ ğŸ‘</span>
      <img src="macaron_pink.png" alt="ãƒ”ãƒ³ã‚¯ã®ãƒã‚«ãƒ­ãƒ³">
      <div class="name">ãƒ”ãƒ³ã‚¯</div>
      <div class="desc">ã‚„ã•ã—ãã¦ç”˜ã‚ã®æ€§æ ¼ã«é€²åŒ–</div>
    </button>

    <button class="card" id="pick-green"  onclick="choose('green')"  aria-label="ã‚°ãƒªãƒ¼ãƒ³ã®ãƒã‚«ãƒ­ãƒ³">
      <span class="badge">è‘‰ã£ã± ğŸƒ</span>
      <img src="macaron_green.png" alt="ã‚°ãƒªãƒ¼ãƒ³ã®ãƒã‚«ãƒ­ãƒ³">
      <div class="name">ã‚°ãƒªãƒ¼ãƒ³</div>
      <div class="desc">è½ã¡ç€ãã¨å›å¾©ãŒå¾—æ„ãªæ€§æ ¼ã«é€²åŒ–</div>
    </button>

    <button class="card" id="pick-blue"   onclick="choose('blue')"   aria-label="ãƒ–ãƒ«ãƒ¼ã®ãƒã‚«ãƒ­ãƒ³">
      <span class="badge">é’ã„çµµã®å…· ğŸ¨</span>
      <img src="macaron_blue.png" alt="ãƒ–ãƒ«ãƒ¼ã®ãƒã‚«ãƒ­ãƒ³">
      <div class="name">ãƒ–ãƒ«ãƒ¼</div>
      <div class="desc">ã‚¯ãƒ¼ãƒ«ã§çŸ¥çš„ãªæ€§æ ¼ã«é€²åŒ–</div>
    </button>

    <button class="card" id="pick-purple" onclick="choose('purple')" aria-label="ãƒ‘ãƒ¼ãƒ—ãƒ«ã®ãƒã‚«ãƒ­ãƒ³">
      <span class="badge">ã¶ã©ã† ğŸ‡</span>
      <img src="macaron_purple.png" alt="ãƒ‘ãƒ¼ãƒ—ãƒ«ã®ãƒã‚«ãƒ­ãƒ³">
      <div class="name">ãƒ‘ãƒ¼ãƒ—ãƒ«</div>
      <div class="desc">ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹ã§æƒ³åƒåŠ›è±Šã‹ãªæ€§æ ¼ã«é€²åŒ–</div>
    </button>
  </div>

  <div class="nav">
    <button class="ghostbtn" onclick="location.href='whoai_talk_tane.html'">ğŸ”™ æˆ»ã‚‹ï¼ˆã‚¿ãƒè¦³å¯Ÿï¼‰</button>
    <button class="ghostbtn" onclick="location.href='index.html'">ğŸ  ãƒ›ãƒ¼ãƒ </button>
  </div>

<script>
  // å…±æœ‰è¡¨ç¤º
  const read = (k,d='')=>{const v=localStorage.getItem(k);return (v===null||v==='undefined'||v==='null')?d:v};
  document.getElementById('chipPlayer').textContent = read('PLAYER_NAME', read('whoai_player_name','ã‚ãªãŸ'));
  document.getElementById('chipColor').textContent  = (read('macaronColor','pink')||'pink').toLowerCase();

  // é¸æŠå‡¦ç†ï¼šè‰²ã‚’ä¿å­˜â†’é€²åŒ–ãƒ•ãƒ©ã‚°â†’æ¼”å‡ºç”»é¢ã¸
  function choose(color){
    localStorage.setItem('macaronColor', color);
    localStorage.setItem('EVOLVED','1');
    localStorage.setItem('EVOLVED_AT', String(Date.now()));

    // é€²åŒ–å¾Œã«ä½¿ã†è»½ã„åˆæœŸåŒ–ï¼ˆä¼šè©±å›æ•°/ãƒ­ã‚°ãªã©ã¯é€²åŒ–å¾Œãƒšãƒ¼ã‚¸ã§å€‹åˆ¥ç®¡ç†ï¼‰
    const uid = localStorage.getItem('whoai_userId');
    if(uid){
      try{
        localStorage.removeItem(`whoai:evolved:${uid}:evolved_conversation:chatLog`);
        localStorage.removeItem(`whoai:evolved:${uid}:evolved_conversation:turn`);
      }catch{}
    }

    // é€²åŒ–æ¼”å‡ºã¸
    location.href = 'evolution.html';
  }

  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œï¼ˆEnterã§æ±ºå®šï¼‰
  document.querySelectorAll('.card').forEach((el)=>{
    el.tabIndex = 0;
    el.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); el.click(); } });
  });
</script>
</body>
</html>
