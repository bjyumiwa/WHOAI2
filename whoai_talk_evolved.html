<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‰ºöË©± | WhoAIÔºàÈÄ≤ÂåñÂæåÔºâ</title>
<meta name="color-scheme" content="dark light" />
<style>
  html,body{height:100%;margin:0;overflow:hidden}
  body{
    font-family:"Noto Sans JP",system-ui,sans-serif;color:#fff;
    background:#000 url("space_background.png") center/cover fixed no-repeat;
    display:flex;align-items:center;justify-content:center;padding:12px;
  }

  /* „Ç¨„É©„ÇπÈ¢®„Çπ„ÉÜ„Éº„Ç∏ */
  .stage{
    position:relative;width:min(92vw,820px);aspect-ratio:1/0.75;overflow:hidden;
    border-radius:24px;background:rgba(0,0,0,.22);
    backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px);
    border:1px solid rgba(255,255,255,.18);
    box-shadow:inset 0 10px 28px rgba(0,0,0,.25),0 10px 28px rgba(0,0,0,.25);
  }

  .charWrap{
    position:absolute;left:50%;top:70%;
    transform:translate(-50%,-50%);
    z-index:2;
    animation:roamPath 36s ease-in-out 1.6s infinite alternate;
  }
  .charImg{
    width:min(22vw,220px);max-width:40vmin;object-fit:contain;
    filter:drop-shadow(0 10px 22px rgba(0,0,0,.45));
    animation:bob 7s ease-in-out infinite;
  }
  @keyframes bob{0%,100%{transform:translateY(-8px)}50%{transform:translateY(8px)}}
  @keyframes roamPath{
    0%{left:20%;top:72%}20%{left:34%;top:56%}
    40%{left:74%;top:62%}60%{left:68%;top:30%}
    80%{left:26%;top:32%}100%{left:20%;top:72%}
  }

  .bubble{
    position:absolute;z-index:5;background:rgba(0,0,0,.55);color:#fff;
    padding:8px 12px;border-radius:14px;font-size:.95rem;opacity:0;
    transition:opacity .4s ease,left 1.1s ease,top 1.1s ease;user-select:none;
    box-shadow:0 6px 14px rgba(0,0,0,.25);
  }

  .floatBtn{
    position:absolute;z-index:5;background:rgba(255,255,255,.85);color:#111;
    font-weight:700;border:none;border-radius:14px;padding:8px 12px;cursor:pointer;
    opacity:.95;box-shadow:0 6px 18px rgba(0,0,0,.28);
    transition:left 1.1s ease,top 1.1s ease,opacity .4s ease;
  }
  .safety{
    position:fixed;right:14px;bottom:14px;z-index:10;background:rgba(255,255,255,.95);
    color:#111;border:none;border-radius:14px;padding:10px 14px;font-weight:700;font-size:.95rem;
    cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.32);
  }
</style>
</head>
<body>
  <main class="stage" aria-live="polite">
    <div class="charWrap">
      <img id="charImg" class="charImg" alt="ÈÄ≤Âåñ„Ç≠„É£„É©" />
    </div>
    <div id="bubble" class="bubble"></div>
    <button id="floatFeedBtn" class="floatBtn" type="button" style="left:16px;top:16px">üç¨ „Éû„Ç´„É≠„É≥„Çí„ÅÇ„Åí„Çã</button>
  </main>
  <button id="safetyBtn" class="safety" type="button">üç¨ „Éû„Ç´„É≠„É≥</button>

<script>
  // ===== Âü∫Êú¨Ë®≠ÂÆö =====
  const KEY={color:'whoai_color',xp:'whoai_xp'};
  const color=(localStorage.getItem(KEY.color)||'pink').toLowerCase();

  const imgEl=document.getElementById('charImg');
  const bubble=document.getElementById('bubble');
  const floatBtn=document.getElementById('floatFeedBtn');
  const safetyBtn=document.getElementById('safetyBtn');
  const stage=document.querySelector('.stage');
  const wrap=document.querySelector('.charWrap');

  let W=stage.offsetWidth,H=stage.offsetHeight;
  addEventListener('resize',()=>{W=stage.offsetWidth;H=stage.offsetHeight;});

  // ===== ÈÄ≤Âåñ„Ç≠„É£„É©ÁîªÂÉèÔºöopen / closed „ÇíÂàá„ÇäÊõø„Åà =====
  const openSrc  = `/WHOAI2/${color}_open.png`;
  const closedSrc= `/WHOAI2/${color}_closed.png`;

  let isOpen=false;
  function showOpen(){ imgEl.src=openSrc; isOpen=true; }
  function showClosed(){ imgEl.src=closedSrc; isOpen=false; }

  // ÂàùÊúü„ÅØ closed
  showClosed();
  // 1Áßí„Åî„Å®„Å´ open / closed Âàá„ÇäÊõø„ÅàÔºàÂè£„Éë„ÇØÔºâ
  setInterval(()=>{ isOpen?showClosed():showOpen(); },1000);

  // ===== Âä±„Åæ„Åó„É°„ÉÉ„Çª„Éº„Ç∏ =====
  const LINES=[
    '„Å†„ÅÑ„Åò„Çá„ÅÜ„Å∂„ÄÅ„ÇÜ„Å£„Åè„Çä„Åß„ÅÑ„ÅÑ„Çà',
    '‰ªäÊó•„ÅÆ„Åå„Çì„Å∞„Çä„ÄÅË¶ã„Å¶„Åü„Çà',
    'Ê∑±ÂëºÂê∏„ÄÅ„ÅÑ„Å£„Åã„ÅÑ„Å≠',
    '„Åç„Åø„ÅÆ„Éö„Éº„Çπ„ÅßÈÄ≤„ÇÇ„ÅÜ',
    '„Éü„Çπ„ÅØÈÄ≤Âåñ„ÅÆ„Çø„Éç„Å†„Çà',
    '„ÇÇ„ÅÜ‰∏ÄÊ≠©„Å†„Åë„ÄÅ„ÅÑ„Å£„Åó„Çá„Å´',
    '‰ºë„ÇÄ„ÅÆ„ÇÇ„ÄÅÂº∑„Åï„Å†„Çà',
    'Â∞è„Åï„Å™‰∏ÄÊ≠©„ÄÅ„Åà„Çâ„ÅÑÔºÅ'
  ];
  const pick=a=>a[Math.floor(Math.random()*a.length)];

  function charCenter(){
    const r=wrap.getBoundingClientRect(), s=stage.getBoundingClientRect();
    return {x:r.left-s.left+r.width/2, y:r.top-s.top+r.height/2};
  }
  function farPos(minDistPx,margin=14){
    const c=charCenter(); let x,y,g=0;
    do{ x=Math.random()*(W-margin*2)+margin; y=Math.random()*(H-margin*2)+margin; g++; if(g>200) break; }
    while(Math.hypot(x-c.x,y-c.y)<minDistPx);
    return {left:x,top:y};
  }
  function showLine(t){
    bubble.textContent=t;
    const p=farPos(160);
    bubble.style.left=p.left+'px'; bubble.style.top=p.top+'px';
    bubble.style.opacity=1; setTimeout(()=>bubble.style.opacity=0,2400);
  }
  setTimeout(()=>showLine(pick(LINES)),1500);
  setInterval(()=>showLine(pick(LINES)),4200);

  // ===== „Éû„Ç´„É≠„É≥Âá¶ÁêÜ =====
  let xp=parseInt(localStorage.getItem(KEY.xp)||'0',10);
  const save=()=>localStorage.setItem(KEY.xp,String(xp));
  function feed(){
    xp++; save(); showLine('„Ç≠„É©„ÉÉ‚òÜ „ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ');
    const p=farPos(180); floatBtn.style.left=p.left+'px'; floatBtn.style.top=p.top+'px';
  }
  floatBtn.addEventListener('click',feed);
  safetyBtn.addEventListener('click',feed);
  addEventListener('keydown',e=>{ if(e.key.toLowerCase()==='m') feed(); });
</script>
</body>
</html>
