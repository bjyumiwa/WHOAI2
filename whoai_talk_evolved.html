<!-- FILE: /whoai_talk_evolved.htmlï¼ˆé€²åŒ–å¾Œï¼šåœ°å¹³ç·šã‹ã‚‰ã‚¿ã‚±ãƒã‚³çš„ã«å‡ºç¾ï¼‹å£ãƒ‘ã‚¯ï¼‹å‘¨å›²UIï¼‰-->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä¼šè©± | WhoAIï¼ˆé€²åŒ–å¾Œï¼‰</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    html,body{height:100%;margin:0;overflow:hidden}
    body{
      font-family:"Noto Sans JP",system-ui,sans-serif;
      color:#fff;
      background:#000 url("space_background.png") center/cover fixed no-repeat;
      display:flex;align-items:center;justify-content:center;
    }

    .stage{
      position:relative;
      width:min(90vw,680px);
      aspect-ratio:1;
      border-radius:20px;
      background:rgba(0,0,0,.12);
      overflow:hidden;
    }

    /* åœ°å¹³ç·šï¼ˆhorizonï¼‰: ã‚¹ãƒ†ãƒ¼ã‚¸ä¸‹éƒ¨ã«ç´°ã„ç·šï¼‹è–„ã„éœã‚’é‡ã­ã¦å¥¥è¡Œãã‚’å‡ºã™ */
    .horizon{
      position:absolute;left:0;right:0;
      bottom:18%;                  /* ã“ã“ãŒâ€œåœ°å¹³ç·šã®é«˜ã•â€ */
      height:2px;
      background:rgba(255,255,255,.35);
      box-shadow:0 0 16px rgba(255,255,255,.35);
      z-index:5;                   /* ã‚­ãƒ£ãƒ©ã‚ˆã‚Šå‰ã«ç½®ãï¼ˆéš ã™ãŸã‚ï¼‰*/
    }
    .horizon::after{
      content:"";
      position:absolute;left:0;right:0;bottom:0;
      height:120px;
      background:linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,.35) 100%);
      pointer-events:none;
    }

    /* ã‚­ãƒ£ãƒ©ã‚’â€œåœ°å¹³ç·šã®ä¸‹ã‹ã‚‰â€å‡ºã™ãŸã‚ã®ãƒ©ãƒƒãƒ‘ã€‚åŸºæº–ç‚¹ã‚’åœ°å¹³ç·šã«åˆã‚ã›ã‚‹ */
    .charWrap{
      position:absolute;left:50%;
      bottom:18%;                  /* åœ°å¹³ç·šã®é«˜ã•ã¨ä¸€è‡´ */
      transform:translateX(-50%);
      z-index:4;                   /* åœ°å¹³ç·šã®â€œå¾Œã‚å´â€ã«ç½®ã */
      animation:sprout 2200ms cubic-bezier(.17,.84,.25,1) 200ms 1 forwards,
                settle 8s ease-in-out 2.4s infinite alternate;
      /* sproutã§å‡ºç¾ â†’ settleã§ã‚†ã‚‰ã‚†ã‚‰ */
    }
    @keyframes sprout{
      0%   { transform:translateX(-50%) translateY(140%); } /* åœ°å¹³ç·šã®ä¸‹ã«éš ã‚Œã¦ã„ã‚‹ */
      70%  { transform:translateX(-50%) translateY(-6%); }  /* å°‘ã—å‡ºéãã¦ã‹ã‚‰ */
      100% { transform:translateX(-50%) translateY(0%); }   /* ã™ã£ã¨è½ã¡ç€ã */
    }
    @keyframes settle{
      from { transform:translateX(-50%) translateY(-3%); }
      to   { transform:translateX(-50%) translateY(3%);  }
    }

    .char{
      width:45vw; max-width:300px; /* ç”»é¢ã«å¿œã˜ã¦è‡ªå‹•èª¿æ•´ */
      object-fit:contain;
      pointer-events:none;
      filter:drop-shadow(0 8px 18px rgba(0,0,0,.35));
    }

    .bubble,.macaron-btn{
      position:absolute;
      font-size:.9rem;
      padding:6px 12px;
      border-radius:12px;
      opacity:.75;
      transition:left 1.2s ease, top 1.2s ease, opacity .4s ease;
      z-index:6;                   /* åœ°å¹³ç·šã‚ˆã‚Šã‚‚å‰ï¼ˆã‚­ãƒ£ãƒ©ã‚ˆã‚Šæ‰‹å‰ï¼‰ */
    }
    .bubble{
      background:rgba(0,0,0,.55);
      color:#fff;
    }
    .macaron-btn{
      background:rgba(255,255,255,.72);
      color:#111;
      cursor:pointer;
      font-weight:600;
      border:none;
    }
  </style>
</head>
<body>

<section class="stage">
  <div class="horizon" aria-hidden="true"></div>

  <!-- åœ°å¹³ç·šã‚’åŸºæº–ã«å‡ºã¦ãã‚‹ãƒ©ãƒƒãƒ‘ã®ä¸­ã«ã‚­ãƒ£ãƒ© -->
  <div class="charWrap">
    <img id="charImg" class="char" src="" alt="evolved character">
  </div>

  <div id="bubble" class="bubble"></div>
  <button id="feedBtn" class="macaron-btn">ğŸ¬ ãƒã‚«ãƒ­ãƒ³ã‚’ã‚ã’ã‚‹</button>
</section>

<script>
  // å®šæ•°
  const KEY={color:'whoai_color',xp:'whoai_xp'};
  const I18N={ja:{lines:['ãµã‚ã€œ','ãã‚‰ã‚Šâ˜…','ã™ã‚„â€¦â€¦','â€¦â€¦']}}; // è¦‹ä¸Šã’æ–‡ã¯å«ã‚ãªã„
  const stage = document.querySelector('.stage');

  // é€²åŒ–å¾Œã‚­ãƒ£ãƒ©ï¼šopen/closedã‚’äº¤äº’ã«å£ãƒ‘ã‚¯
  const charImg = document.getElementById('charImg');
  const color   = localStorage.getItem(KEY.color)||'pink';
  let toggle=false;
  function swapMouth(){
    toggle=!toggle;
    charImg.src=`/WHOAI2/${color}_${toggle?'open':'closed'}.png`;
  }
  swapMouth();
  setInterval(swapMouth, 1000);

  // ã‚¹ãƒ†ãƒ¼ã‚¸å¯¸æ³•ï¼ˆãƒªã‚µã‚¤ã‚ºã«ã‚‚è¿½å¾“ï¼‰
  let stageW=stage.offsetWidth, stageH=stage.offsetHeight;
  window.addEventListener('resize', ()=>{stageW=stage.offsetWidth; stageH=stage.offsetHeight;});

  // ã‚­ãƒ£ãƒ©ä¸­å¿ƒï¼ˆåœ°å¹³ç·šä¸Šã®ä¸­å¤®ï¼‰ã‹ã‚‰ä¸€å®šè·é›¢ä»¥ä¸Šé›¢ã‚ŒãŸãƒ©ãƒ³ãƒ€ãƒ åº§æ¨™
  function getRandomFarPosition(minDistPx){
    const cx = stageW/2, cy = stageH*0.82; // åœ°å¹³ç·šã®yï¼ˆbottom:18% â†’ é«˜ã•ã®82%ï¼‰
    let x,y;
    do{
      x = Math.random()*stageW;
      y = Math.random()*stageH;
    }while(Math.hypot(x-cx,y-cy) < minDistPx);
    return {left:x, top:y};
  }

  // å¹ãå‡ºã—
  const bubble = document.getElementById('bubble');
  function r(a){return a[Math.floor(Math.random()*a.length)]}
  function showLine(t){
    bubble.textContent=t;
    bubble.style.opacity=.85;
    const pos=getRandomFarPosition(140);
    bubble.style.left=pos.left+'px';
    bubble.style.top =pos.top +'px';
    setTimeout(()=>bubble.style.opacity=0, 2000);
  }
  setTimeout(()=>{ showLine(r(I18N.ja.lines)); }, 2600);           // å‡ºç¾ã‚¢ãƒ‹ãƒ¡ã®å¾Œã«åˆå›
  setInterval(()=>showLine(r(I18N.ja.lines)), 4200);

  // ãƒã‚«ãƒ­ãƒ³ï¼šUIã¯ã‚­ãƒ£ãƒ©ã¨é›¢ã‚ŒãŸä½ç½®ã«â€œå‡ºæ²¡â€
  const feedBtn = document.getElementById('feedBtn');
  let xp = parseInt(localStorage.getItem(KEY.xp)||'0',10);
  const XP_TO_NEXT = 10;
  function saveXP(){ localStorage.setItem(KEY.xp, xp); }
  function placeBtn(){
    const pos=getRandomFarPosition(150);
    feedBtn.style.left=pos.left+'px';
    feedBtn.style.top =pos.top +'px';
  }
  setTimeout(placeBtn, 2500); // ã‚­ãƒ£ãƒ©å‡ºç¾å¾Œã«æœ€åˆã®é…ç½®
  feedBtn.addEventListener('click', ()=>{
    xp++; saveXP();
    showLine('ã±ã‚ã£ï¼');
    placeBtn();
    if(xp>=XP_TO_NEXT){
      setTimeout(()=>location.href='rebirth.html', 800);
    }
  });
</script>

</body>
</html>
